# AI æµè§ˆå™¨å¼€å‘è·¯çº¿å›¾

> å°† Lumina Note æ‰©å±•ä¸º **AI çŸ¥è¯†åŠ©æ‰‹ + è½»é‡æµè§ˆå™¨** çš„æ··åˆå·¥å…·

## ğŸ¯ ç›®æ ‡

æ‰“é€ ä¸€ä¸ªèƒ½å¤Ÿï¼š
1. **ç®¡ç†æœ¬åœ°å†…å®¹** - ç¬”è®°ã€æ–‡ä»¶ã€çŸ¥è¯†åº“
2. **è®¿é—®ç½‘é¡µ** - æœç´¢ã€æµè§ˆã€é˜…è¯»
3. **AI å¯¹è¯** - ç»“åˆæœ¬åœ°å’Œç½‘é¡µå†…å®¹è¿›è¡Œé—®ç­”
4. **Add to Chat** - å°†ä»»æ„å†…å®¹ï¼ˆç¬”è®°/ç½‘é¡µ/é€‰ä¸­æ–‡æœ¬ï¼‰æ·»åŠ åˆ°å¯¹è¯ä¸Šä¸‹æ–‡

## ğŸ“ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¾§è¾¹æ   â”‚               å†…å®¹åŒº                     â”‚  AI Chat    â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ ğŸ“ ç¬”è®°  â”‚ â”Œâ”€ æ ‡ç­¾é¡µ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ ğŸ“ å¼•ç”¨:    â”‚
â”‚  ğŸ“„ æ—¥è®° â”‚ â”‚ ğŸ“„ ç¬”è®°.md â”‚ ğŸŒ Google â”‚ ğŸŒ æ–‡ç«    â”‚â”‚  - ç¬”è®°.md  â”‚
â”‚  ğŸ“„ é¡¹ç›® â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  - ç½‘é¡µURL  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”Œâ”€ åœ°å€æ  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ ğŸŒ ä¹¦ç­¾  â”‚ â”‚ ğŸ” https://example.com          [â†’] â”‚â”‚ [ç”¨æˆ·æ¶ˆæ¯]  â”‚
â”‚  â­ GitHubâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚             â”‚
â”‚  â­ æ–‡æ¡£ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ [AI å›å¤]   â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚                                       â”‚â”‚             â”‚
â”‚ ğŸ• å†å²  â”‚ â”‚       ç¬”è®°å†…å®¹ / ç½‘é¡µæ¸²æŸ“              â”‚â”‚             â”‚
â”‚          â”‚ â”‚                                       â”‚â”‚             â”‚
â”‚          â”‚ â”‚  [Add to Chat] [ä¿å­˜ç¬”è®°] [åŠ ä¹¦ç­¾]   â”‚â”‚             â”‚
â”‚          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ [è¾“å…¥æ¡†]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¸ƒå±€è¯´æ˜**ï¼š
- **å·¦ä¾§**: æ–‡ä»¶æ ‘ + ä¹¦ç­¾ + å†å²ï¼ˆç±»ä¼¼ç°æœ‰å¸ƒå±€ï¼‰
- **ä¸­é—´**: ä¸»å†…å®¹åŒºï¼ˆç¬”è®°ç¼–è¾‘ / ç½‘é¡µæµè§ˆï¼Œæ”¯æŒå¤šæ ‡ç­¾é¡µï¼‰
- **å³ä¾§**: AI Chat é¢æ¿ï¼ˆå¯å±•å¼€/æ”¶èµ·ï¼‰

## ğŸ”§ æŠ€æœ¯æ–¹æ¡ˆ

### å¯å¤ç”¨çš„ç°æœ‰æ¨¡å—

| æ¨¡å— | ä½ç½® | è¯´æ˜ |
|------|------|------|
| Tauri æ¡†æ¶ | `src-tauri/` | Rust åç«¯ + React å‰ç«¯ |
| LLM æœåŠ¡å±‚ | `src/services/llm/` | 8 ä¸ª Providerï¼Œæµå¼è¾“å‡º |
| Agent ç³»ç»Ÿ | `src/agent/` | å·¥å…·è°ƒç”¨æ¶æ„ |
| RAG ç³»ç»Ÿ | `src/services/rag/` | å¯ç”¨äºç½‘é¡µå†…å®¹ç´¢å¼• |
| UI ç»„ä»¶ | `src/components/` | ä¾§è¾¹æ ã€æ ‡ç­¾é¡µã€è®¾ç½® |
| **ğŸ¬ Bç«™è§†é¢‘åŠŸèƒ½** | `src/components/video/` | **å†…åµŒ WebView æ¶æ„ï¼Œå¯ç›´æ¥å¤ç”¨ï¼** |

### â­ å¯å¤ç”¨ï¼šBç«™è§†é¢‘åŠŸèƒ½

> **é‡è¦å‘ç°**ï¼šBç«™è§†é¢‘ç¬”è®°åŠŸèƒ½å·²ç»å®ç°äº†å®Œæ•´çš„å†…åµŒ WebView æ¶æ„ï¼Œå¯ä»¥ç›´æ¥ç”¨äºæµè§ˆå™¨å¼€å‘ï¼

#### å·²æœ‰çš„ Rust å‘½ä»¤ï¼ˆç›´æ¥å¯ç”¨ï¼‰

```rust
// src-tauri/src/commands/mod.rs

// åˆ›å»ºå†…åµŒ WebViewï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼ï¼‰
#[tauri::command]
pub async fn create_embedded_webview(
    app: AppHandle, 
    url: String,      // ä»»æ„ URL
    x: f64, y: f64,   // ä½ç½®
    width: f64, height: f64  // å¤§å°
) -> Result<(), AppError>

// æ›´æ–° WebView ä½ç½®å’Œå¤§å°
#[tauri::command]
pub async fn update_webview_bounds(app: AppHandle, x: f64, y: f64, width: f64, height: f64)

// å…³é—­ WebView
#[tauri::command]
pub async fn close_embedded_webview(app: AppHandle)

// æ‰“å¼€æ–°çª—å£
#[tauri::command]
pub fn open_new_window(app: AppHandle, url: String, title: String)
```

#### å·²æœ‰çš„å‰ç«¯ç»„ä»¶

```typescript
// src/components/video/VideoNoteView.tsx
// å·²å®ç°ï¼š
// - å†…åµŒ WebView åˆ›å»ºå’Œç®¡ç†
// - WebView ä½ç½®/å¤§å°å“åº”å¼æ›´æ–°
// - ä¸ä¸»çª—å£çš„äº¤äº’

// src/types/videoNote.ts
// å·²å®ç°ï¼š
// - URL è§£æå·¥å…·å‡½æ•°
// - å†…å®¹ä¿å­˜ä¸º Markdown
// - frontmatter è§£æ
```

#### å¤ç”¨æ–¹å¼

1. **å†…åµŒ WebView** - `create_embedded_webview` å·²ç»æ”¯æŒä»»æ„ URLï¼Œä¸ä»…é™äº Bç«™
2. **WebView ç®¡ç†** - ä½ç½®æ›´æ–°ã€å…³é—­ç­‰å‘½ä»¤ç°æˆå¯ç”¨
3. **ä¿å­˜ä¸ºç¬”è®°** - `videoNoteToMarkdown` å¯å‚è€ƒå®ç°ç½‘é¡µä¿å­˜

#### éœ€è¦æ‰©å±•çš„éƒ¨åˆ†

| åŠŸèƒ½ | ç°æœ‰å®ç° | éœ€è¦æ‰©å±• |
|------|----------|----------|
| åˆ›å»º WebView | âœ… æ”¯æŒä»»æ„ URL | å¤šæ ‡ç­¾é¡µæ”¯æŒï¼ˆæ”¹ webview id ä¸ºåŠ¨æ€ï¼‰ |
| å¯¼èˆªæ§åˆ¶ | âŒ æ—  | æ–°å¢ `navigate_webview`, `go_back`, `go_forward` |
| è·å–é¡µé¢ä¿¡æ¯ | âŒ æ—  | æ–°å¢ `get_page_title`, `get_page_url` |
| å†…å®¹æå– | âœ… å¼¹å¹•è·å–ï¼ˆå‚è€ƒï¼‰ | æ–°å¢ `extract_page_content` |

### éœ€è¦æ–°å¢çš„æ¨¡å—

| æ¨¡å— | æŠ€æœ¯æ–¹æ¡ˆ | è¯´æ˜ |
|------|----------|------|
| ç½‘é¡µæœç´¢ | Bing/Google/Tavily API | æœç´¢å¼•æ“é›†æˆ |
| ç½‘é¡µæŠ“å– | Rust reqwest + scraper | è·å–ç½‘é¡µå†…å®¹ |
| å†…å®¹æå– | Readability.js | æå–æ­£æ–‡ï¼Œå»é™¤å¹¿å‘Š |
| å†…åµŒæµè§ˆå™¨ | Tauri WebviewWindow / iframe | ç½‘é¡µæ¸²æŸ“ |
| ä¹¦ç­¾ç³»ç»Ÿ | SQLite / JSON | ä¹¦ç­¾å­˜å‚¨å’Œç®¡ç† |
| å†å²è®°å½• | SQLite | æµè§ˆå†å² |

## ğŸ“… å¼€å‘é˜¶æ®µ

> **å¼€å‘é¡ºåºåŸåˆ™**: å…ˆåšåŸºç¡€æµè§ˆå™¨åŠŸèƒ½ï¼Œå†æ·±åº¦èåˆ AI

---

### Phase 1: å†…åµŒæµè§ˆå™¨åŸºç¡€ (1-2 å‘¨)

**ç›®æ ‡**: èƒ½åœ¨åº”ç”¨å†…æµè§ˆç½‘é¡µï¼Œæ”¯æŒæ ‡ç­¾é¡µåˆ‡æ¢

> âš¡ **å¥½æ¶ˆæ¯**ï¼šBç«™è§†é¢‘åŠŸèƒ½å·²å®ç°å†…åµŒ WebViewï¼Œå¯ç›´æ¥å¤ç”¨ï¼

#### 1.1 æŠ€æœ¯æ–¹æ¡ˆï¼ˆåŸºäºç°æœ‰å®ç°ï¼‰

**ç›´æ¥å¤ç”¨ Bç«™ WebView æ¶æ„ï¼š**

```rust
// âœ… å·²æœ‰ - src-tauri/src/commands/mod.rs
create_embedded_webview(app, url, x, y, width, height)  // åˆ›å»º
update_webview_bounds(app, x, y, width, height)         // æ›´æ–°ä½ç½®
close_embedded_webview(app)                              // å…³é—­
```

**éœ€è¦æ–°å¢çš„å‘½ä»¤ï¼š**

```rust
// ğŸ†• éœ€è¦æ–°å¢
#[tauri::command]
pub async fn create_browser_webview(
    app: AppHandle,
    tab_id: String,    // åŠ¨æ€ IDï¼Œæ”¯æŒå¤šæ ‡ç­¾é¡µ
    url: String,
    x: f64, y: f64, width: f64, height: f64
) -> Result<(), AppError>

#[tauri::command]
pub async fn navigate_webview(app: AppHandle, tab_id: String, url: String)

#[tauri::command]
pub async fn webview_go_back(app: AppHandle, tab_id: String)

#[tauri::command]
pub async fn webview_go_forward(app: AppHandle, tab_id: String)

#[tauri::command]
pub async fn webview_reload(app: AppHandle, tab_id: String)
```

#### 1.2 æ ‡ç­¾é¡µç³»ç»Ÿæ‰©å±•

```typescript
// æ‰©å±•ç°æœ‰çš„æ ‡ç­¾é¡µç³»ç»Ÿ
type TabType = 'note' | 'webpage' | 'graph';

interface Tab {
  id: string;
  type: TabType;
  title: string;
  path?: string;   // ç¬”è®°è·¯å¾„
  url?: string;    // ç½‘é¡µ URL
  favicon?: string;
}

// src/stores/useUIStore.ts æ‰©å±•
interface UIState {
  tabs: Tab[];
  activeTabId: string;
  // ...
}
```

#### 1.3 æµè§ˆå™¨ UI ç»„ä»¶

```tsx
// src/components/browser/BrowserView.tsx
export function BrowserView({ url, onNavigate }: BrowserViewProps) {
  return (
    <div className="browser-view">
      {/* åœ°å€æ  */}
      <AddressBar 
        url={url} 
        onNavigate={onNavigate}
        onBack={() => {}}
        onForward={() => {}}
        onRefresh={() => {}}
      />
      
      {/* ç½‘é¡µå†…å®¹ */}
      <WebContent url={url} />
    </div>
  );
}
```

#### 1.4 äº¤ä»˜ç‰©
- [x] å†…åµŒ WebView æ¸²æŸ“ç½‘é¡µ
- [x] åœ°å€æ ç»„ä»¶ï¼ˆURL è¾“å…¥ + å¯¼èˆªæŒ‰é’®ï¼‰
- [x] æ ‡ç­¾é¡µæ”¯æŒç½‘é¡µç±»å‹
- [x] å‰è¿›/åé€€/åˆ·æ–°åŠŸèƒ½
- [x] æ–°å»ºç½‘é¡µæ ‡ç­¾é¡µå…¥å£

#### 1.5 å®ç°æ–‡ä»¶ï¼ˆå·²å®Œæˆï¼‰

**Rust åç«¯** (`src-tauri/src/commands/mod.rs`)ï¼š
- `create_browser_webview` - åˆ›å»ºæµè§ˆå™¨ WebViewï¼ˆå¤šæ ‡ç­¾é¡µæ”¯æŒï¼‰
- `update_browser_webview_bounds` - æ›´æ–° WebView ä½ç½®å¤§å°
- `close_browser_webview` - å…³é—­ WebView
- `navigate_browser_webview` - å¯¼èˆªåˆ°æ–° URL
- `browser_webview_go_back` / `go_forward` / `reload` - å¯¼èˆªæ§åˆ¶
- `set_browser_webview_visible` - å¯è§æ€§æ§åˆ¶

**å‰ç«¯ç»„ä»¶** (`src/components/browser/`)ï¼š
- `BrowserView.tsx` - æµè§ˆå™¨ä¸»è§†å›¾ç»„ä»¶
- `AddressBar.tsx` - åœ°å€æ ç»„ä»¶ï¼ˆè¾“å…¥ã€å¯¼èˆªæŒ‰é’®ã€å®‰å…¨æŒ‡ç¤ºï¼‰
- `index.ts` - å¯¼å‡ºæ–‡ä»¶

**Store æ‰©å±•** (`src/stores/useFileStore.ts`)ï¼š
- `TabType` æ–°å¢ `webpage`
- `Tab` æ–°å¢ `webpageUrl`, `webpageTitle` å±æ€§
- `openWebpageTab()` - æ‰“å¼€ç½‘é¡µæ ‡ç­¾é¡µ
- `updateWebpageTab()` - æ›´æ–°ç½‘é¡µæ ‡ç­¾é¡µä¿¡æ¯

**UI é›†æˆ**ï¼š
- `App.tsx` - æ·»åŠ  webpage æ ‡ç­¾é¡µæ¸²æŸ“åˆ†æ”¯
- `TabBar.tsx` - æ·»åŠ  Globe å›¾æ ‡æ˜¾ç¤º
- `Ribbon.tsx` - æ·»åŠ æµè§ˆå™¨æŒ‰é’®å…¥å£

---

### Phase 2: ä¹¦ç­¾ä¸å†å² (1 å‘¨)

**ç›®æ ‡**: å®Œå–„æµè§ˆå™¨åŸºç¡€åŠŸèƒ½

#### 2.1 ä¹¦ç­¾ç³»ç»Ÿ

```typescript
// src/stores/useBookmarkStore.ts
interface Bookmark {
  id: string;
  url: string;
  title: string;
  favicon?: string;
  folderId?: string;  // æ‰€å±æ–‡ä»¶å¤¹
  createdAt: number;
}

interface BookmarkFolder {
  id: string;
  name: string;
  parentId?: string;
}
```

#### 2.2 å†å²è®°å½•

```typescript
// src/stores/useHistoryStore.ts
interface HistoryEntry {
  id: string;
  url: string;
  title: string;
  favicon?: string;
  visitedAt: number;
}
```

#### 2.3 ä¾§è¾¹æ æ‰©å±•

```tsx
// åœ¨ä¾§è¾¹æ æ·»åŠ ä¹¦ç­¾å’Œå†å²å…¥å£
<SidebarSection title="ä¹¦ç­¾" icon={Star}>
  <BookmarkList />
</SidebarSection>

<SidebarSection title="å†å²" icon={Clock}>
  <HistoryList />
</SidebarSection>
```

#### 2.4 äº¤ä»˜ç‰©
- [ ] ä¹¦ç­¾æ·»åŠ /åˆ é™¤/ç¼–è¾‘
- [ ] ä¹¦ç­¾æ–‡ä»¶å¤¹ç®¡ç†
- [ ] å†å²è®°å½•è‡ªåŠ¨ä¿å­˜
- [ ] ä¾§è¾¹æ ä¹¦ç­¾/å†å²é¢æ¿
- [ ] æ¸…é™¤å†å²åŠŸèƒ½

---

### Phase 3: ç½‘é¡µå†…å®¹æå– (1-2 å‘¨)

**ç›®æ ‡**: èƒ½å¤Ÿæå–ç½‘é¡µæ­£æ–‡ï¼Œä¿å­˜ä¸ºç¬”è®°

#### 3.1 Rust ç«¯ç½‘é¡µæŠ“å–

```rust
// src-tauri/src/web.rs
#[tauri::command]
async fn fetch_webpage(url: String) -> Result<WebpageContent, String> {
    let html = reqwest::get(&url).await?.text().await?;
    // ä½¿ç”¨ scraper æå–æ­£æ–‡
}

#[derive(Serialize)]
struct WebpageContent {
    url: String,
    title: String,
    content: String,      // æ¸…æ´çš„æ­£æ–‡ (Markdown)
    description: String,  // æ‘˜è¦
    favicon: Option<String>,
}
```

#### 3.2 å†…å®¹æå–ç®—æ³•

é€‰é¡¹ï¼š
- **Readability.js** - Mozilla å¼€æºï¼Œå‰ç«¯è¿è¡Œ
- **Rust scraper + è‡ªå®šä¹‰è§„åˆ™** - åç«¯è¿è¡Œ
- **Jina Reader API** - äº‘æœåŠ¡ï¼Œç®€å•å¯é 

#### 3.3 ä¿å­˜ä¸ºç¬”è®°

```typescript
const saveWebpageAsNote = async (webpage: WebpageContent) => {
  const markdown = `# ${webpage.title}

> æ¥æº: [${webpage.url}](${webpage.url})
> ä¿å­˜æ—¶é—´: ${new Date().toLocaleString()}

---

${webpage.content}`;

  await createNote(`å‰ªè—/${sanitizeFilename(webpage.title)}.md`, markdown);
};
```

#### 3.4 äº¤ä»˜ç‰©
- [ ] Rust ç½‘é¡µæŠ“å–å‘½ä»¤
- [ ] æ­£æ–‡æå–ï¼ˆå»å¹¿å‘Š/å»å¯¼èˆªï¼‰
- [ ] "ä¿å­˜ä¸ºç¬”è®°" æŒ‰é’®
- [ ] å‰ªè—æ–‡ä»¶å¤¹ç®¡ç†

---

### Phase 4: AI æ·±åº¦èåˆ (2 å‘¨)

**ç›®æ ‡**: AI èƒ½å¤Ÿæœç´¢ç½‘é¡µã€é˜…è¯»å†…å®¹ã€ä¸æœ¬åœ°ç¬”è®°ç»“åˆ

#### 4.1 æ–°å¢ Agent å·¥å…·

```typescript
// web_search - æœç´¢ç½‘é¡µ
export const webSearchDefinition: ToolDefinition = {
  name: "web_search",
  description: "æœç´¢ç½‘é¡µï¼Œè¿”å›ç›¸å…³ç»“æœåˆ—è¡¨",
  parameters: [
    { name: "query", type: "string", required: true, description: "æœç´¢å…³é”®è¯" },
    { name: "limit", type: "number", required: false, description: "ç»“æœæ•°é‡ï¼Œé»˜è®¤ 5" },
  ],
};

// read_webpage - è¯»å–ç½‘é¡µå†…å®¹
export const readWebpageDefinition: ToolDefinition = {
  name: "read_webpage",
  description: "è¯»å–ç½‘é¡µå†…å®¹ï¼Œè¿”å›æ¸…æ´çš„æ­£æ–‡",
  parameters: [
    { name: "url", type: "string", required: true, description: "ç½‘é¡µ URL" },
  ],
};
```

#### 4.2 Rust ç«¯æœç´¢ API

```rust
// src-tauri/src/web.rs
#[tauri::command]
async fn web_search(query: String, limit: Option<u32>) -> Result<Vec<SearchResult>, String> {
    // è°ƒç”¨ Bing/Tavily API
}

#[derive(Serialize)]
struct SearchResult {
    title: String,
    url: String,
    snippet: String,
}
```

#### 4.3 Add to Chat åŠŸèƒ½

```typescript
// ç»Ÿä¸€å¼•ç”¨ç³»ç»Ÿ
interface Reference {
  type: 'note' | 'webpage' | 'selection';
  id: string;
  title: string;
  content: string;
  source: {
    path?: string;      // ç¬”è®°è·¯å¾„
    url?: string;       // ç½‘é¡µ URL
  };
}

// åœ¨ Chat ä¸­å¼•ç”¨
interface ChatMessage {
  role: 'user' | 'assistant';
  content: string;
  references?: Reference[];
}
```

#### 4.4 ç½‘é¡µå†…å®¹é€‰ä¸­å¼•ç”¨

```tsx
// é€‰ä¸­æ–‡æœ¬åæ˜¾ç¤º "Add to Chat" æŒ‰é’®
const handleTextSelection = () => {
  const selection = window.getSelection()?.toString();
  if (selection) {
    showAddToChatButton(selection);
  }
};
```

#### 4.5 äº¤ä»˜ç‰©
- [ ] `web_search` Agent å·¥å…·
- [ ] `read_webpage` Agent å·¥å…·
- [ ] "Add to Chat" æŒ‰é’®ï¼ˆç½‘é¡µ/é€‰ä¸­æ–‡æœ¬ï¼‰
- [ ] ç»Ÿä¸€å¼•ç”¨ UI
- [ ] AI ç»“åˆæœ¬åœ°ç¬”è®° + ç½‘é¡µå†…å®¹å›ç­”

---

## ğŸ”Œ API é€‰æ‹©

### æœç´¢ API

| æœåŠ¡ | ç‰¹ç‚¹ | ä»·æ ¼ |
|------|------|------|
| **Tavily** | ä¸“ä¸º AI è®¾è®¡ï¼Œè¿”å›æ¸…æ´å†…å®¹ | $0.01/search |
| **Bing Search** | å¾®è½¯å®˜æ–¹ï¼Œç¨³å®š | $3/1000 æ¬¡ |
| **SerpAPI** | å¤šæœç´¢å¼•æ“æ”¯æŒ | $50/æœˆèµ· |
| **Google Custom Search** | å®˜æ–¹ API | $5/1000 æ¬¡ |

**æ¨è**: Tavilyï¼ˆAI ä¼˜åŒ–ï¼‰æˆ– Bingï¼ˆç¨³å®šä¾¿å®œï¼‰

### ç½‘é¡µå†…å®¹æå–

| æ–¹æ¡ˆ | è¯´æ˜ |
|------|------|
| **Readability.js** | Mozilla å¼€æºï¼Œå‰ç«¯/Node.js |
| **trafilatura** | Python åº“ï¼Œæ•ˆæœå¥½ |
| **Rust scraper** | åŸç”Ÿ Rustï¼Œé«˜æ€§èƒ½ |
| **Jina Reader API** | äº‘æœåŠ¡ï¼Œå…è´¹é¢åº¦ |

---

## â±ï¸ æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | å·¥ä½œé‡ | ç´¯è®¡æ—¶é—´ | å¤‡æ³¨ |
|------|--------|----------|------|
| Phase 1: å†…åµŒæµè§ˆå™¨åŸºç¡€ | 1-2 å‘¨ | 1-2 å‘¨ | âš¡ å¤ç”¨ Bç«™ WebView |
| Phase 2: ä¹¦ç­¾ä¸å†å² | 1 å‘¨ | 2-3 å‘¨ | |
| Phase 3: ç½‘é¡µå†…å®¹æå– | 1-2 å‘¨ | 3-5 å‘¨ | |
| Phase 4: AI æ·±åº¦èåˆ | 2 å‘¨ | 5-7 å‘¨ | |

**æ€»è®¡**: çº¦ **5-7 å‘¨** å®Œæˆå®Œæ•´ç‰ˆ AI æµè§ˆå™¨

> ğŸ’¡ ç”±äº Bç«™è§†é¢‘åŠŸèƒ½å·²å®ç°æ ¸å¿ƒ WebView æ¶æ„ï¼ŒPhase 1 å¯ä»¥æ›´å¿«å®Œæˆï¼

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨ (MVP)

ç”±äº Bç«™åŠŸèƒ½å·²æœ‰ WebView åŸºç¡€ï¼Œå¯ä»¥æ›´å¿«ï¼š

1. **Day 1-2**: å¤åˆ¶ `VideoNoteView.tsx` çš„ WebView é€»è¾‘ï¼Œæ”¹ä¸ºé€šç”¨æµè§ˆå™¨
2. **Day 3-4**: æ·»åŠ åœ°å€æ ç»„ä»¶ + å¯¼èˆªæŒ‰é’®
3. **Day 5-6**: æ‰©å±•æ ‡ç­¾é¡µç³»ç»Ÿæ”¯æŒ `webpage` ç±»å‹
4. **Day 7**: ç®€å•ä¹¦ç­¾åŠŸèƒ½

è¿™æ · **1 å‘¨**å°±èƒ½æœ‰ä¸€ä¸ªèƒ½æµè§ˆç½‘é¡µçš„åŸºç¡€æµè§ˆå™¨æ¡†æ¶ï¼

### MVP æ ¸å¿ƒä»£ç å‚è€ƒ

```tsx
// ä» Bç«™åŠŸèƒ½å¤åˆ¶çš„ WebView åˆ›å»ºé€»è¾‘
// src/components/video/VideoNoteView.tsx ç¬¬ 96-116 è¡Œ

const createWebview = useCallback(async () => {
  const container = containerRef.current;
  const rect = container.getBoundingClientRect();
  
  await invoke('create_embedded_webview', {
    url: currentUrl,
    x: rect.left,
    y: rect.top,
    width: rect.width,
    height: rect.height,
  });
}, [currentUrl]);
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **è·¨åŸŸé—®é¢˜**: ç½‘é¡µåµŒå…¥ä¼šé‡åˆ° CORSï¼Œéœ€è¦ä»£ç†æˆ– Tauri å¤„ç†
2. **å®‰å…¨è€ƒè™‘**: ä¸è¦åœ¨ WebView ä¸­æ‰§è¡Œä¸å¯ä¿¡çš„ JavaScript
3. **æ€§èƒ½ä¼˜åŒ–**: å¤§ç½‘é¡µçš„æŠ“å–å’Œæ¸²æŸ“éœ€è¦ä¼˜åŒ–
4. **API è´¹ç”¨**: æœç´¢ API æœ‰è°ƒç”¨é™åˆ¶ï¼Œéœ€è¦ç¼“å­˜ç­–ç•¥

---

## ğŸ“š å‚è€ƒé¡¹ç›®

- [ArcSearch](https://arc.net/) - AI æµè§ˆå™¨æ ‡æ†
- [SigmaOS](https://sigmaos.com/) - å·¥ä½œæµæµè§ˆå™¨
- [Perplexity](https://perplexity.ai/) - AI æœç´¢å¼•æ“
- [Kagi](https://kagi.com/) - ä»˜è´¹æœç´¢å¼•æ“
